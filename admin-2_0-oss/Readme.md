LANBilling OSS
===========================

Работа с проектом
-----------------

Для работы с поднятым проектом разработчик на локальной машине должен установить минимальный набор инструментов содержащийся в пакете Sencha Cmd. Установка пакета описана в разделе "Зависимости сборки проекта". После того, как проект поднять из Git, нужно перейти в директорию public и выполнить следующие команды:

```
$> sencha app refresh
$> sencha app build testing
```

Структура проекта
--------------------------
 /
    \ app (будет удалена) 
    \ css (будет удалена)
    \ framework (базовые файлы YII)
    \ images (будет удалена)
    \ protected (back-end приложение)
    \ public (front-end приложение)
    \ sass (будет удалена)
    \ scripts (будет удалена)
    \ test (файлы авто тестов)
 

Переопределение настроек приложения
--------------------------------------

Базовые натсройки приложения хранятся в protected/config/settings.php

Для того, чтобы переопределить значения по умолчанию файла settings.php разработчик должен создать папку protected/config/develop и в ней разместить конфигурацию с новыми значениями. Имя и количество файлов значения не имеют, будут подключены все файлы *.php в алфавитном порятдке. Последний подключенный перепишет предыдущие значения.

Пример изменения подключения к LBcore

```
01-connection.php

<?php

return array(
    'params' => array(
        'requestHost' => '192.168.30.10'
    )
);

```

Зависимости сборки проекта
--------------------------

Необходимо наличие следующих программных продуктов:

- Phing (php приложение)
- JAVA
- Sencha Cmd 

Все инструкции ниже по установке приведены для Linux на основе debian

Установка Phing из репозитория pear

```
$> sudo apt-get install php-pear
$> sudo pear channel-discover pear.phing.info
$> sudo pear install [--alldeps] phing/phing
```

За подробностями установки Phing: http://www.phing.info/trac/wiki/Users/Installation

Установка последней стабильной версии JAVA машины, это можно быть либо sun-java, либо openjdk:

```
$> sudo apt-get install sun-java6-bin
```

или

```
$> sudo apt-get install openjdk-7-jre
```

Скачать Sencha Cmd с сайта производителя по ссылке http://www.sencha.com/products/sencha-cmd/download
На момент написания этого файла версия Sencha Cmd v4.0.0.203 Стоит помнить очень важное правило при работе с Cmd: версия утилиты должна быть одинакова на всех рабочих станциях разработчиков из-за постоянной смены формата workspace производителем

Сборка
------

В корне проекта выполнить:

```
$> phing
```

Во время сборки создается папка build в которой находятся подготовленные файлы.

Режимы сборки:

- Продуктив
- Тестирование

```
$> phing -Dmode=production
$> phing -Dmode=testing
```

Проверка качества кода
----------------------

Проверка качества кода необходима для выявления и устранения ошибок невнимательности, повышения читаемости кода, документирования, а так же качественному построению логических операций основываясь на рекоммендациях утилиты. 
Проверка **не выполняется** на этапе сборки пакета.

##### Зависимость

Для корректной работы на машине разработчика должны быть установлены следующие пакеты: NodeJS, JSHint, Code_Sniffer
Инструкция по установке NodeJS и JSHint: https://git.lanbilling.ru/web/codesniffer/tree/OSS
Инструкция по установке Code_Sniffer: https://git.lanbilling.ru/web/codesniffer/tree/master
По инструкциям ** достаточно ** только установить необходимое ПО, необходимые стандарты и правила проверки будут подняты из GIT

##### Запуск проверки

Проверка backend и frontend

```
$> phing ccode
```

Проверка backend

```
$> phing ccode -Dcheck=php
```

Проверка frontend

```
$> phing ccode -Dcheck=js
```

Проверка отдельного файла или каталога

```
$> phing ccode -Dfile=public/app/view/Viewport.js
```
