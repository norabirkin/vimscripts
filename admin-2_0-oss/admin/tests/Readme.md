Интеграционное тестирование LANBilling OSS, административная часть
==================================================================

Интеграционное тестирование проводится средствами Rspec утилиты, написанной на ruby. Участи cucumber в процессе тестирования не рассматривается, чтобы сократить процесс написания тестов и их выполнение

Структура папок
-----------

```
 /
    \ tests
      \ spec
        \ support (вспомогательные модули)
        \ spec_helper.rb (Файл настройки, подключается во все тесты)
      \ Gemfile (Перечень завичимостей для bundle)
```


Установка зависимостей
-----------------------

Рекомендуется установить RVM для разделения версионных зависимостей ruby. Требуется версия ruby не ниже 1.9.3

Для Mac Os желательно наличие ports, так как сборка и установка языка потребует стороннюю библиотеку gcc

```
$> curl -sSL https://get.rvm.io | bash -s stable
```

Список доступных версий

```
$> rvm list known
```

В качестве примера выбрана версия 1.9.3

```
$> rvm install 1.9.3
```

Чтобы задействовать установленную версию. Ключ --default сделает выбраную версию по умолчанию

```
$> rvm use 1.9.3
```

Перейти в папку tests и установить зависимости

```
$> bundle install
```


Настройка
-----------

Конфигурация храниться в файле spec_helper.rb

Используемый драйвер для вполнения проверки
Capybara.default_driver 

Сервер на котором расположен интерфейс. Указывается только протокол и адрес 'http://192.168.70.83'
Capybara.app_host

Ожидание асинхронных операций
Capybara.default_wait_time



Запуск тестов
--------------

Перейти в паку tests и выполнить команду

```
$> rspec
```

Указание нестандартного расположения интерфейса на сервере

```
$> export admin_path=/admin/build/admin/public && rspec
```

Запуск отдельного теста

```
$> rspec spec/signin_spec.rb
```

Написание тестов
----------------

Файл с тестами должен именоваться по шаблону КРАТКОИМЯ_spec.rb и сохраняться в tests/spec. Первые две строки файла отводяться для указания кодировки и загрузки вспомогательных модулей, далее объявляется главноая группа действий в которой первые два блока before и after отвечают за то, чтобы авторизоваться и разлогинится в том случае, если тест запускается не в составе полной группы тестирования. Ублоков after и и before есть две важные опции :all и :each.
:all - выполнить блок один раз вначале списка последующих событий, либо после если применяется в after. :each (если не указывать, то эта опция устанавливается по умолчанию) - выполняет блок перед иил после каждого действия. Внутри основного блока describe действия стоит дробить на логические группы операций, которые так же включают before, но с указанием :each, это поможет перехватить окно авторизации и уйти в ошибку в случае обрыва сессии.
it - шаг внутри группы. 

Описания груп действий должны быть краткие и локаничные. Каждый шаг в группе начинается с маленькой буквы, глагол или глагольное существительное


```
# encoding: UTF-8
require 'spec_helper'

describe 'Проверка некоего функционала' do
  before(:all) do
    admin_page

    if login?
      authorize "admin", ""
    end
  end
  
  after(:all, :logout => true) do
    if login?
      tb_menu_click "Выход", :main_menu => true
    end
  end
  
  describe 'Проверка А'do
    before do
      if login?
        raise Capybara::ElementNotFound.new("Не авторизован")
      end
    end
    
    it 'выполнить пример' do
    end
  end
  
  describe 'Проверка Б'do
    before do
      if login?
        raise Capybara::ElementNotFound.new("Не авторизован")
      end
    end
    
    it 'выполнить пример' do
    end
  end
end
```

Вспомогательные модули и класс
---------------------------------

#### testhelper (общие функции)

- admin_page : Перейти на страницу админки
- login? : Проверить наличие окна авторизации
- authorize : Авторизоваться
- set_text_field : Установить значение  input элемента (Текстовые поля, checkbox)
- set_combo_field : Установить значение комбы
- set_search_field : Установить значение триггер-поля с поиском
- tb_button_click : Кликнуть кнопку
- tb_menu_click : Кликнуть меню
- message_box? : Проверить наличие сообщения и кликнуть в нем кнопку (последнее опционально)
- validate_combo_field : Провирить содержимое комбы
- validate_text_field : Проверить содержимое текствого поля или checkbox
- get_active_tab_component : Вернуть ID активной вкладки по названию


#### grid (работа с гридами)

#### window (работа с окнами)


